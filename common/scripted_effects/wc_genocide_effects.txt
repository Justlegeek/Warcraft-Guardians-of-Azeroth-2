# Remove ongoing modifiers when title changes hands: on_title_gain, on_county_occupied
remove_genocide_modifiers = { 
    if = { 
        limit = { 
            has_county_modifier = ongoing_genocide
        }

        remove_county_modifier = ongoing_genocide
    }
}

remove_genocide_variables = {
    if = {
        limit = {
            has_variable = culture_genocided
            OR = {
                NOT = {
                    culture = holder.culture
                }
                always = $REMOVE$
            }
        }

        remove_variable = culture_genocided
    }

    if = {
        limit = {
            has_variable = faith_genocided
            OR = {
                NOT = {
                    faith = holder.faith
                }
                always = $REMOVE$
            }
        }

        remove_variable = faith_genocided
    }
}

purge_population_effect = { 
    scope:county ?= {
        remove_county_modifier = ongoing_genocide
        if = { 
            limit = { 
                has_variable = purge_population_current_progress
                var:purge_population_current_progress >= 12
            }

            remove_variable = purge_population_current_progress

            if = { 
                limit = { 
                    NOT = { 
                        holder = scope:councillor_liege
                    }
                    NOR = { 
                        holder.culture = scope:councillor_liege.culture
                        holder.faith = scope:councillor_liege.faith
                    }
                }

                holder = {
                    save_temporary_scope_as = old_holder
                }

                create_title_and_vassal_change = {
                    type = usurped
                    add_claim_on_loss = yes
                    save_scope_as = change
                }

                change_title_holder = { 
                    holder = scope:councillor_liege
                    change = scope:change
                    take_baronies = yes
                }

                resolve_title_and_vassal_change = scope:change

                scope:old_holder = { 
                    if = { 
                        limit = { 
                            is_ruler = no
                        }

                        death = { 
                            death_reason = death_execution
                            killer = scope:councillor_liege
                        }
                    }
                }
            }

            genocide_culture_effect = { MULT = 2 }
            genocide_faith_effect = yes
            genocide_common_effect = { MULT = 2 MOD = minority_disapproves_of_genocide_population_opinion }

            trigger_event = { 
                on_action = on_reduce_purge_modifier_on_action
                days = 1200
            }

            # TODO: Should destroy random building, not sure if possible in CK3
        }
    }
}

genocide_culture_effect = { 
    if = { 
        limit = { 
            from_allow_genocide_this_province_culture_trigger = yes
        }

        culture = {
            save_scope_as = old_culture
            change_cultural_acceptance = { 
                target = scope:councillor_liege.culture
                value = { 
                    value = -30
                    multiply = $MULT$
                }
                desc = cultural_acceptance_loss_purge_pupulation
            }
        }

        set_variable = { 
            name = culture_genocided
            value = scope:old_culture
        }


        set_county_culture = scope:councillor_liege.culture
    }
}

genocide_faith_effect = { 
    if = { 
        limit = { 
            from_allow_genocide_this_province_religion_trigger = yes
        }

        faith = { 
            save_scope_as = old_faith
        }

        set_variable = { 
            name = faith_genocided
            value = scope:old_faith
        }


        set_county_faith = scope:councillor_liege.faith
    }
}

genocide_common_effect = { 
    scope:councillor_liege = {
        if = {
            limit = {
                any_vassal = {
                    has_vassal_stance = minority
                }
            }
            custom_tooltip = minority_disapproves_conversion
            hidden_effect = {
                every_vassal = {
                    limit = {
                        has_vassal_stance = minority
                    }
                    add_opinion = {
                        target = scope:councillor_liege
                        modifier = $MOD$
                    }
                }
            }
        }
    }

    change_county_control = {
        value = -30
        multiply = $MULT$
    }
    change_development_level = {
        value = -10
        multiply = $MULT$
    }
    add_county_modifier = { 
        modifier = county_purged_modifier_3
    }
}