add_genocide_cb_rewards = {
    save_scope_value_as = { name = attacker_culture_reward_mult value = 0 }
    save_scope_value_as = { name = attacker_faith_reward_mult value = 0 }
    save_scope_value_as = { name = defender_culture_reward_mult value = 0 }
    save_scope_value_as = { name = defender_faith_reward_mult value = 0 }
    save_scope_value_as = { name = base_prestige value = $PRESTIGE_BASE_VALUE$ }
    save_scope_value_as = { name = base_piety value = $PIETY_BASE_VALUE$ }
    scope:defender = {
        every_realm_county = {
            limit = {
                OR = {
                    AND = {
                        has_variable = culture_genocided
                        var:culture_genocided = scope:attacker.culture
                    }

                    AND = {
                        has_variable = faith_genocided
                        var:faith_genocided = scope:attacker.faith
                    }
                }
            }

            if = {
                limit = {
                    has_variable = culture_genocided
                }

                save_scope_value_as = {
                    name = attacker_culture_reward_mult
                    value = {
                        value = scope:attacker_culture_reward_mult
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:win
                            }
                            add = 1
                        }
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:white_peace
                            }
                            add = 0.5
                        }
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:loss
                            }
                            add = -1
                        }
                    }
                }
                save_scope_value_as = {
                    name = defender_culture_reward_mult
                    value = {
                        value = scope:defender_culture_reward_mult
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:win
                            }
                            add = -1
                        }
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:loss
                            }
                            add = 1
                        }
                    }
                }
            }
            if = {
                limit = {
                    has_variable = faith_genocided
                }

                save_scope_value_as = {
                    name = attacker_faith_reward_mult
                    value = {
                        value = scope:attacker_faith_reward_mult
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:win
                            }
                            add = 1
                        }
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:white_peace
                            }
                            add = 0.5
                        }
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:loss
                            }
                            add = -1
                        }
                    }
                }
                save_scope_value_as = {
                    name = defender_faith_reward_mult
                    value = {
                        value = scope:defender_faith_reward_mult
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:win
                            }
                            add = -1
                        }
                        if =  {
                            limit = {
                                $OUTCOME$ = flag:loss
                            }
                            add = 1
                        }
                    }
                }
            }

            if = {
                limit = {
                    $OUTCOME$ = flag:win
                }

                change_title_holder = {
                    holder = scope:attacker
                    change = scope:change
                    take_baronies = yes
                }
            }
        }
    }

    scope:attacker = {
        add_prestige = {
            value = scope:base_prestige
            multiply = scope:attacker_culture_reward_mult
        }

        add_piety = {
            value = scope:base_piety
            multiply = scope:attacker_faith_reward_mult
        }
    }

    scope:defender = {
        if = {
            limit = {
                NOT = {
                    scope:defender_culture_reward_mult = 0
                }
            }
            add_prestige = {
                value = scope:base_prestige
                multiply = scope:defender_culture_reward_mult
            }
        }

        if = {
            limit = {
                NOT = {
                    scope:defender_faith_reward_mult = 0
                }
            }
            add_piety = {
                value = scope:base_piety
                multiply = scope:defender_faith_reward_mult
            }
        }
    }

    if = {
        limit = {
            $OUTCOME$ = flag:loss
        }

        # Allies on both sides get full prestige value for helping in the war, based on their war participation.
        modify_allies_of_participants_fame_values_genocide = {
            WINNER = scope:defender
            FAME_BASE = genocide_cb_participation_prestige
            PIETY_BASE = genocide_cb_participation_piety
            GIVE_FAITH_REWARDS = genocide_cb_can_avenge_faith
            GIVE_CULTURE_REWARDS = genocide_cb_can_avenge_culture
            WINNER_ALLY_FAME_SCALE = 1
            LOSER_ALLY_FAME_SCALE = 1
        }
    }
    else = {
        # Allies on both sides get full prestige value for helping in the war, based on their war participation.
        modify_allies_of_participants_fame_values_genocide = {
            WINNER = scope:attacker
            FAME_BASE = genocide_cb_participation_prestige
            PIETY_BASE = genocide_cb_participation_piety
            GIVE_FAITH_REWARDS = genocide_cb_can_avenge_faith
            GIVE_CULTURE_REWARDS = genocide_cb_can_avenge_culture
            WINNER_ALLY_FAME_SCALE = 1
            LOSER_ALLY_FAME_SCALE = 1
        }
    }
}

modify_allies_of_participants_fame_values_genocide = {
    # Give the allies of both primary participants the appropriate type & amount of 'fame'.

    if = {
        # Religious wars award Piety to participants.
        limit = {
            OR = {
                $GIVE_FAITH_REWARDS$ = yes
                #always = yes
            }
        }
        if = {
            # Award Piety to the victorious attacker's allies.
            limit = {
                $WINNER$ = scope:attacker
            }
            add_from_contribution_attackers = {
                piety = {
                    value = $PIETY_BASE$
                    multiply = $WINNER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
            # Award Piety to the defeated defender's allies.
            add_from_contribution_defenders = {
                piety = {
                    value = $PIETY_BASE$
                    multiply = $LOSER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
        }
        else = {
            # Award Piety to the victorious defender's allies.
            add_from_contribution_defenders = {
                piety = {
                    value = $PIETY_BASE$
                    multiply = $WINNER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
            # Award Piety to the defeated attacker's allies.
            add_from_contribution_attackers = {
                piety = {
                    value = $PIETY_BASE$
                    multiply = $LOSER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
        }
    }
    if = {
        limit = {
            $GIVE_CULTURE_REWARDS$ = yes
        }
        # All other war types award Prestige to participants.
        if = {
            # Award Prestige to the victorious attacker's allies.
            limit = {
                $WINNER$ = scope:attacker
            }
            add_from_contribution_attackers = {
                prestige = {
                    value = $FAME_BASE$
                    multiply = $WINNER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
            # Award Prestige to the defeated defender's allies.
            add_from_contribution_defenders = {
                prestige = {
                    value = $FAME_BASE$
                    multiply = $LOSER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
        }
        else = {
            # Award Prestige to the victorious defender's allies.
            add_from_contribution_defenders = {
                prestige = {
                    value = $FAME_BASE$
                    multiply = $WINNER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
            # Award Prestige to the defeated attacker's allies.
            add_from_contribution_attackers = {
                prestige = {
                    value = $FAME_BASE$
                    multiply = $LOSER_ALLY_FAME_SCALE$
                }
                opinion = {
                    modifier = contributed_in_war
                }
            }
        }
    }
}