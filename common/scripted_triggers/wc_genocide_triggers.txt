#################################
# Corruption                    #
#################################

#######################
#  Is corrupted       #
#######################

# Check if province is corrupted with the modifier beneficial to the liege, with specific magic type
is_corrupt_this_province_specific_trigger = {
    has_county_modifier = $MOD$

    scope:councillor_liege = {
        can_corrupt_specific_trigger = { BEING = $BEING$ MAGIC = $MAGIC$ }
    }
    trigger_if = {
        limit = { scope:councillor_liege = { is_independent_ruler = no } }
        scope:councillor_liege.top_liege = {
            can_corrupt_specific_trigger = { BEING = $BEING$ MAGIC = $MAGIC$ }
        }
    }
}

# Check if province is corrupted with the modifier beneficial to the liege, with any magic type
is_corrupt_this_province_trigger = {
    OR = {
        is_corrupt_this_province_specific_trigger = { BEING = being_light MAGIC = light MOD = county_corruption_light }
        is_corrupt_this_province_specific_trigger = { BEING = being_void MAGIC = shadow MOD = county_corruption_void }
        is_corrupt_this_province_specific_trigger = { BEING = being_order MAGIC = order MOD = county_corruption_arcane }
        is_corrupt_this_province_specific_trigger = { BEING = being_demon MAGIC = disorder MOD = county_corruption_fel }
        is_corrupt_this_province_specific_trigger = { BEING = being_life MAGIC = life MOD = county_corruption_life }
        is_corrupt_this_province_specific_trigger = { BEING = being_undead MAGIC = death MOD = county_corruption_death }
    }
}

#######################
#  Can be corrupted   #
#######################

# Check if the character is allowed the Corrupt action instead of Purge
can_corrupt_trigger = {
    OR = {
        has_being_trait_trigger = yes
        has_culture_being_trait_gfx_trigger = yes
        AND = {
            evil_public_religion_trigger = yes
            faith = {
                has_doctrine = doctrine_light_magic_approved
                has_doctrine = doctrine_shadow_magic_approved
                has_doctrine = doctrine_order_magic_approved
                has_doctrine = doctrine_disorder_magic_approved
                has_doctrine = doctrine_life_magic_approved
                has_doctrine = doctrine_death_magic_approved
            }
        }
    }
}

# Check if character can corrupt a specific magic type
can_corrupt_specific_trigger = {
    OR = {
        has_trait = $BEING$
        culture = {
            has_clothing_gfx = $BEING$_gfx
        }
        AND = {
            evil_public_religion_trigger = yes
            faith = {
                has_doctrine = doctrine_$MAGIC$_magic_approved
            }
        }
    }
}

# Check if the Corrupt task can be used on a county, with a specific magic type
can_corrupt_this_province_specific_trigger = {
    OR = {
        NOT = { has_county_modifier = $MOD$ }
        NOT = { culture = scope:councillor_liege.culture }
        NOT = { faith = scope:councillor_liege.faith }
    }
    scope:councillor_liege = {
        can_corrupt_specific_trigger = { BEING = $BEING$ MAGIC = $MAGIC$ }
    }
    trigger_if = {
        limit = { scope:councillor_liege = { is_independent_ruler = no } }
        scope:councillor_liege.top_liege = {
            can_corrupt_specific_trigger = { BEING = $BEING$ MAGIC = $MAGIC$ }
        }
    }
}

# Check if the Corrupt task can be used on a county, with a any magic type
allow_corrupt_this_province_trigger = {
    OR = {
        can_corrupt_this_province_specific_trigger = { BEING = being_light MAGIC = light MOD = county_corruption_light }
        can_corrupt_this_province_specific_trigger = { BEING = being_void MAGIC = shadow MOD = county_corruption_void }
        can_corrupt_this_province_specific_trigger = { BEING = being_order MAGIC = order MOD = county_corruption_arcane }
        can_corrupt_this_province_specific_trigger = { BEING = being_demon MAGIC = disorder MOD = county_corruption_fel }
        can_corrupt_this_province_specific_trigger = { BEING = being_life MAGIC = life MOD = county_corruption_life }
        can_corrupt_this_province_specific_trigger = { BEING = being_undead MAGIC = death MOD = county_corruption_death }
    }
}

#################################
# Corruption modifier scale     #
#################################

corruption_scale_specific_trigger = {
    var:corruption_type ?= flag:$MOD$
    holder = {
        trigger_if = {
            limit = {
                $IS_EXTREME$ = yes
            }
            NOT = {
                has_trait = $BEING_OPPOSITE$
            }
        }
        OR = {
            trigger_if = {
                limit = {
                    $IS_EXTREME$ = yes
                }
                OR = {
                    has_trait = $BEING$
                    culture = {
                        has_clothing_gfx = $BEING$_gfx
                    }
                }
            }
            faith = {
                has_doctrine = doctrine_$MAGIC$_magic_$MAGIC_LEVEL$
            }
        }
    }
}

corruption_scale_extreme_pos_trigger = {
    OR = {
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_light BEING_OPPOSITE = being_void MAGIC = light MAGIC_LEVEL = approved MOD = county_corruption_light }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_void BEING_OPPOSITE = being_light MAGIC = shadow MAGIC_LEVEL = approved MOD = county_corruption_void }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_order BEING_OPPOSITE = being_demon MAGIC = order MAGIC_LEVEL = approved MOD = county_corruption_arcane }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_demon BEING_OPPOSITE = being_order MAGIC = disorder MAGIC_LEVEL = approved MOD = county_corruption_fel }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_life BEING_OPPOSITE = being_undead MAGIC = life MAGIC_LEVEL = approved MOD = county_corruption_life }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_undead BEING_OPPOSITE = being_life MAGIC = death MAGIC_LEVEL = approved MOD = county_corruption_death }
    }
}

corruption_scale_mild_pos_trigger = {
    OR = {
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_light BEING_OPPOSITE = being_void MAGIC = light MAGIC_LEVEL = accepted MOD = county_corruption_light }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_void BEING_OPPOSITE = being_light MAGIC = shadow MAGIC_LEVEL = accepted MOD = county_corruption_void }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_order BEING_OPPOSITE = being_demon MAGIC = order MAGIC_LEVEL = accepted MOD = county_corruption_arcane }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_demon BEING_OPPOSITE = being_order MAGIC = disorder MAGIC_LEVEL = accepted MOD = county_corruption_fel }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_life BEING_OPPOSITE = being_undead MAGIC = life MAGIC_LEVEL = accepted MOD = county_corruption_life }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_undead BEING_OPPOSITE = being_life MAGIC = death MAGIC_LEVEL = accepted MOD = county_corruption_death }
    }
}

corruption_scale_extreme_neg_trigger = {
    OR = {
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_void BEING_OPPOSITE = being_light MAGIC = light MAGIC_LEVEL = crime MOD = county_corruption_light }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_light BEING_OPPOSITE = being_void MAGIC = shadow MAGIC_LEVEL = crime MOD = county_corruption_void }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_demon BEING_OPPOSITE = being_order MAGIC = order MAGIC_LEVEL = crime MOD = county_corruption_arcane }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_order BEING_OPPOSITE = being_demon MAGIC = disorder MAGIC_LEVEL = crime MOD = county_corruption_fel }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_undead BEING_OPPOSITE = being_life MAGIC = life MAGIC_LEVEL = crime MOD = county_corruption_life }
        corruption_scale_specific_trigger = { IS_EXTREME = yes BEING = being_life BEING_OPPOSITE = being_undead MAGIC = death MAGIC_LEVEL = crime MOD = county_corruption_death }
    }
}

corruption_scale_mild_neg_trigger = {
    OR = {
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_void BEING_OPPOSITE = being_light MAGIC = light MAGIC_LEVEL = shunned MOD = county_corruption_light }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_light BEING_OPPOSITE = being_void MAGIC = shadow MAGIC_LEVEL = shunned MOD = county_corruption_void }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_demon BEING_OPPOSITE = being_order MAGIC = order MAGIC_LEVEL = shunned MOD = county_corruption_arcane }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_order BEING_OPPOSITE = being_demon MAGIC = disorder MAGIC_LEVEL = shunned MOD = county_corruption_fel }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_undead BEING_OPPOSITE = being_life MAGIC = life MAGIC_LEVEL = shunned MOD = county_corruption_life }
        corruption_scale_specific_trigger = { IS_EXTREME = no BEING = being_life BEING_OPPOSITE = being_undead MAGIC = death MAGIC_LEVEL = shunned MOD = county_corruption_death }
    }
}

#################################
# Purge                         #
#################################

# Monster cultures can genocide own heritage
monster_culture_trigger = {
	OR = {
		culture = culture:scourge
		culture = culture:naga
		culture = culture:satyr
		culture = culture:faldorei
	}
}

# Can this character genocide their own heritage
can_genocide_own_culture_group_trigger = {
    OR = {
        monster_culture_trigger = yes
        culture = {
            has_cultural_pillar = heritage_mogu
        }
        $LIEGE$ = { 
            OR = { 
                monster_culture_trigger = yes
                culture = {
                    has_cultural_pillar = heritage_mogu
                }
            }
        }
    }
}

# Can this character genocide their own religion
can_genocide_own_religion_trigger = {
    always = no
    OR = { 
        $LIEGE$ = { 

        }
    }
}

# Check if genocide should be allowed because they are evil
can_genocide_evil_trigger = {
    OR = {
        is_aggressive_trigger = yes
        $LIEGE$ = { is_aggressive_trigger = yes }
        evil_public_religion_trigger = yes
        $LIEGE$ = { evil_public_religion_trigger = yes }
    }
}

has_faith_hostility_trigger = { 
    faith = {
        faith_hostility_level = {
            target = $LIEGE$.faith
            value >= faith_$LEVEL$_level
        }
    }
}

allow_genocide_this_province_culture_trigger = {
    # These cultures can be genocided by their own group
    OR = {
        trigger_if = {
            limit = {
                can_genocide_own_culture_group_trigger = { LIEGE = scope:councillor_liege }
            }
            NOT = { culture = scope:councillor_liege.culture }
        }
        trigger_else = {
            NOT = { culture = { has_same_culture_heritage = scope:councillor_liege.culture } }
        }

        AND = {
            NOT = { culture = scope:councillor_liege.culture }
            can_genocide_evil_trigger = { LIEGE = scope:councillor_liege }
        }
    }
    trigger_if = { # If the character is not independant, make sure their liege would approve
        limit = { scope:councillor_liege = { is_independent_ruler = no } }
        OR = {
            # These cultures can be genocided by their own group
            trigger_if = {
                limit = {
                    can_genocide_own_culture_group_trigger = { LIEGE = scope:councillor_liege.top_liege }
                }
                NOT = { culture = scope:councillor_liege.top_liege.culture }
            }
            trigger_else = {
                NOT = { culture = { has_same_culture_heritage = scope:councillor_liege.top_liege.culture } }
            }

            AND = {
                NOT = { culture = scope:councillor_liege.top_liege.culture }
                can_genocide_evil_trigger = { LIEGE = scope:councillor_liege.top_liege }
            }
        }
    }
}

allow_genocide_this_province_religion_trigger = {
    OR = {
        # These religions can be genocided by their own group
        trigger_if = {
            limit = {
                can_genocide_own_religion_trigger = { LIEGE = scope:councillor_liege }
            }
            NOT = { faith = scope:councillor_liege.faith }
            has_faith_hostility_trigger = { LIEGE = scope:councillor_liege LEVEL = astray }
        }
        trigger_else = {
            NOT = { religion = scope:councillor_liege.religion }
            has_faith_hostility_trigger = { LIEGE = scope:councillor_liege LEVEL = hostile }
        }

        AND = {
            NOT = { faith = scope:councillor_liege.faith }
            can_genocide_evil_trigger = { LIEGE = scope:councillor_liege }
        }
    }
    trigger_if = { # If the character is not independant, make sure their liege would approve
        limit = { scope:councillor_liege = { is_independent_ruler = no } }
        OR = {
            # These cultures can be genocided by their own group
            trigger_if = {
                limit = {
                    can_genocide_own_religion_trigger = { LIEGE = scope:councillor_liege.top_liege }
                }
                NOT = { faith = scope:councillor_liege.top_liege.faith }
                has_faith_hostility_trigger = { LIEGE = scope:councillor_liege.top_liege LEVEL = astray }
            }
            trigger_else = {
                NOT = { religion = scope:councillor_liege.top_liege.religion }
                has_faith_hostility_trigger = { LIEGE = scope:councillor_liege.top_liege LEVEL = hostile }
            }

            AND = {
                NOT = { faith = scope:councillor_liege.top_liege.faith }
                can_genocide_evil_trigger = { LIEGE = scope:councillor_liege.top_liege }
            }
        }
    }
}

allow_genocide_this_province_trigger = {
    OR = {
        allow_genocide_this_province_culture_trigger = yes
        allow_genocide_this_province_religion_trigger = yes
	}
}