task_purge_population = {
	position = councillor_marshal

	task_type = task_type_county
	county_target = realm
	ai_county_target = domain
	task_progress = task_progress_value
	task_current_value = scope:councillor_liege.marshal_purge_population_current_progress
	task_max_value = marshal_purge_population_threshold
	highlight_own_realm = yes
	restart_on_finish = no

	progress = {
		value = 0
		add = {
			value = marshal_purge_population_base_total
			desc = INCREASE_CONTROL_BASE
		}

		add = {
			value = marshal_purge_population_skill_bonus
			desc = SCALED_COUNCILLOR_MARTIAL_VALUE
		}

		# Relation Bonuses/Penalties
		if = { # Friend
			limit = {
				scope:councillor_liege = {
					has_relation_friend = scope:councillor
					NOT = { has_relation_best_friend = scope:councillor }
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_friend_bonus
				desc = COUNCILLOR_IS_YOUR_FRIEND
			}
		}
		if = { # Best Friend
			limit = {
				scope:councillor_liege = {
					has_relation_best_friend = scope:councillor
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_best_friend_bonus
				desc = COUNCILLOR_IS_YOUR_BEST_FRIEND
			}
		}
		if = { # Rival
			limit = {
				scope:councillor_liege = {
					has_relation_rival = scope:councillor
					NOT = { has_relation_nemesis = scope:councillor }
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_rival_bonus
				desc = COUNCILLOR_IS_YOUR_RIVAL
			}
		}
		if = { # Nemesis
			limit = {
				scope:councillor_liege = {
					has_relation_nemesis = scope:councillor
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_nemesis_bonus
				desc = COUNCILLOR_IS_YOUR_NEMESIS
			}
		}

		#Partially completed bonuses
		if = { # Same culture
			limit = {
				scope:county = {
					culture = scope:councillor_liege.culture
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_same_culture_bonus
				desc = COUNTY_IS_YOUR_CULTURE
			}
		}
		if = { # Same faith
			limit = {
				scope:county = {
					faith = scope:councillor_liege.faith
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_same_faith_bonus
				desc = COUNTY_IS_YOUR_FAITH
			}
		}
		if = { # Has corruption modifier
			limit = {
				scope:councillor_liege = {
					can_corrupt_trigger = yes
				}
				scope:county = {
					has_beneficial_corruption_this_province_trigger = yes
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_already_corrupted_bonus
				DESC = COUNTY_ALREADY_CORRUPTED
			}
		}

		if = {
			limit = {
				scope:county = {
					allow_genocide_this_province_religion_trigger = yes
				}
			}
			add = {
				value = scope:councillor.marshal_purge_population_monthly_increase_fervor_penalty
				DESC = MARSHAL_GENOCIDE_FERVOR_IMPACT
			}
		}

		# Development reduces the speed. Should be the last non-multiply modifier applied to avoid negative values
		if = {
			limit = {
				exists = scope:county
				scope:county = {
					development_level > 0
				}
			}
			add = {
				value = scope:county.marshal_purge_population_monthly_increase_development_penalty
				desc = STEWARD_PROMOTE_CULTURE_DEVELOPMENT_PENALTY
			}
		}

	}

	potential_county = {
		scope:county = {
			trigger_if = {
				limit = {
					scope:councillor_liege = {
						can_corrupt_trigger = yes
					}
				}

				allow_corrupt_this_province_trigger = yes
			}
			trigger_else = {
				OR = {
					allow_cleanse_this_province_trigger = yes
					allow_genocide_this_province_trigger = yes
				}
			}
		}
	}

	on_start_task_county = {
		scope:county = {
			if = {
				limit = {
					allow_corrupt_this_province_trigger = yes
				}

				add_county_modifier = ongoing_corruption
			}
			else_if = {
				limit = {
					allow_cleanse_this_province_trigger = yes
				}

				add_county_modifier = ongoing_cleansing
			}
			else = {
				add_county_modifier = ongoing_genocide
			}
		}
	}

	on_cancel_task_county = {
		scope:county = {
			remove_genocide_modifiers = yes
		}
	}

	on_finish_task_county = {
		scope:county = {
			if = {
				limit = {
					has_county_modifier = ongoing_corruption
				}

				corrupt_county_effect = { ON_START = no }
			}
			else_if = {
				limit = {
					has_county_modifier = ongoing_cleansing
				}

				cleanse_county_effect = yes
			}
			else = {
				purge_population_effect = yes
			}
		}

		scope:councillor = {
			start_default_task = yes
		}
	}

	on_monthly_county = {
		if = {
			limit = {
				NOT = {
					scope:county ?= {
						has_variable = purge_population_current_progress
					}
				}
			}

			scope:county = {
				set_variable = {
					name = purge_population_current_progress
					value = 0
				}
			}
		}

		scope:county = {
			change_variable = {
				name = purge_population_current_progress
				add = marshal_purge_population_total
			}
		}
	}

	ai_will_do = {
		value = 0
	}

}
task_relocate_population = {

}