namespace = genocide_task

genocide_task.0001 = {
    type = character_event
    title = genocide_task.0001.t
    desc = genocide_task.0001.desc
    theme = death
    left_portrait = {
        character = scope:councillor_liege
        animation = personality_callous
    }

    trigger = {
        scope:county = {
            has_county_modifier = ongoing_corruption_modifier
        }
        exists = cp:councillor_marshal
        scope:councillor = cp:councillor_marshal
        scope:councillor ?= {
            martial < high_skill_rating
        }
        any_neighboring_county = {
            holder.top_liege = scope:county.holder.top_liege
        }
    }

    weight_multiplier = {
        base = 1
        compare_modifier = {
            target = scope:councillor
            value = martial
            multiplier = -0.2
            offset = inverted_high_skill_rating
        }
    }

    immediate = {
        set_variable = {
            name = had_genocide_task_side_effect
            value = yes
            days = genocide_task_side_effect_cooldown
        }

        scope:county = {
            every_neighboring_county = {
                limit = {
                    this.holder.top_liege = scope:county.holder.top_liege
                }

                add_county_modifier = {
                    modifier = corruption_disease_modifier
                    days = 100
                }
            }
        }
    }

    option = {
        name = genocide_task.0001.a

        stress_impact = {
            zealous = major_dread_loss
            sadistic = major_dread_loss
            arbitrary = major_dread_loss
            callous = major_dread_loss

            forgiving = major_dread_gain
            just = major_dread_gain
            generous = major_dread_gain
            compassionate = major_dread_gain
        }

        ai_chance = {
            base = 50
        }
    }
}

genocide_task.0201 = { # Re-flavored version of genocide_task.0001 for purge instead of corrupt
    type = character_event
    title = genocide_task.0201.t
    desc = genocide_task.0201.desc
    theme = death
    left_portrait = {
        character = scope:councillor_liege
        animation = personality_callous
    }

    trigger = {
        scope:county = {
            has_county_modifier = ongoing_genocide_modifier
        }
        exists = cp:councillor_marshal
        scope:councillor = cp:councillor_marshal
        scope:councillor ?= {
            martial < high_skill_rating
        }
        any_neighboring_county = {
            holder.top_liege = scope:county.holder.top_liege
        }
    }

    weight_multiplier = {
        base = 1
        compare_modifier = {
            target = scope:councillor
            value = martial
            multiplier = -0.2
            offset = inverted_high_skill_rating
        }
    }

    immediate = {
        set_variable = {
            name = had_genocide_task_side_effect
            value = yes
            days = genocide_task_side_effect_cooldown
        }

        scope:county = {
            every_neighboring_county = {
                limit = {
                    this.holder.top_liege = scope:county.holder.top_liege
                }

                add_county_modifier = {
                    modifier = genocidal_unrest_modifier
                    days = 100
                }
            }
        }
    }

    option = {
        name = genocide_task.0201.a

        stress_impact = {
            zealous = major_dread_loss
            sadistic = major_dread_loss
            arbitrary = major_dread_loss
            callous = major_dread_loss

            forgiving = major_dread_gain
            just = major_dread_gain
            generous = major_dread_gain
            compassionate = major_dread_gain
        }

        ai_chance = {
            base = 50
        }
    }
}

genocide_task.0301 = {
    type = character_event
    title = genocide_task.0301.t
    desc = genocide_task.0301.desc
    theme = martial
    override_background = { reference = burning_building }
    left_portrait = {
        character = cp:councillor_court_chaplain
        animation = personality_zealous
    }

    right_portrait = {
        character = scope:councillor_liege
        animation = throne_room_kneel_1
    }

    lower_center_portrait = {
        character = scope:councillor
    }

    trigger = {
        scope:county = {
            has_county_modifier = ongoing_corruption_modifier
        }
        exists = cp:councillor_marshal
        scope:councillor = cp:councillor_marshal
        scope:councillor ?= {
            martial >= high_skill_rating
        }
        cp:councillor_court_chaplain ?= {
            learning > mediocre_skill_rating
        }
    }

    weight_multiplier = {
        base = 1
        compare_modifier = {
            target = scope:councillor
            value = martial
            multiplier = 0.15
            offset = inverted_high_skill_rating
        }
        compare_modifier = {
            target = cp:councillor_court_chaplain
            value = learning
            multiplier = 0.05
            offset = inverted_mediocre_skill_rating
        }
    }

    immediate = {
        cp:councillor_court_chaplain = {
            save_scope_as = cp_court_chaplain
        }
        set_variable = {
            name = had_genocide_task_side_effect
            value = yes
            days = genocide_task_side_effect_cooldown
        }
    }

    option = {
        name = genocide_task.0301.a

        add_dread = major_dread_gain

        stress_impact = {
            forgiving = major_dread_gain
            just = major_dread_gain
            generous = major_dread_gain
            compassionate = major_dread_gain
        }

        ai_chance = {
            base = 50

            modifier = {
                OR = {
                    has_trait = forgiving
                    has_trait = just
                    has_trait = generous
                    has_trait = compassionate
                }
                add = -25
            }
        }
    }

    option = {
        name = genocide_task.0301.b

        add_piety = 100

        stress_impact = {
            zealous = minor_dread_gain
            sadistic = minor_dread_gain
            callous = minor_dread_gain
        }

        ai_chance = {
            base = 50

            modifier = {
                OR = {
                    has_trait = zealous
                    has_trait = sadistic
                    has_trait = callous
                }
                add = -25
            }
        }
    }

    option = {
        name = genocide_task.0301.c

        trigger = {
            OR = {
                has_trait = magic_good
                has_trait = magic_good_noninheritable
            }
        }

        add_dread = medium_dread_gain
        add_piety = minor_piety_value
        add_character_modifier = {
            modifier = harmonize_with_force_modifier
            days = 100
        } # TODO: Infusion 2024, add infusion

        ai_chance = {
            base = 250
        }
    }
}