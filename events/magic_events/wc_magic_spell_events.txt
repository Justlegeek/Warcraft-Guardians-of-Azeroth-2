namespace = wc_magic_spell_events

wc_magic_spell_events.1001 = {
    hidden = yes
    immediate = {
        remove_trait = polymorph
        add_prowess_skill = {
            value = scope:polymorph_prowess
            multiply = -1
        }
    }
}

wc_magic_spell_events.2001 = {
    type = character_event
    title = wc_magic_spell_events.2001.title
    desc = wc_magic_spell_events.2001.desc
    theme = order

    left_portrait = {
        character = root
        animation = toast
    }

    option = {
        name = wc_magic_spell_events.2001.a

        custom_tooltip = wc_magic_spell_events.2001.a.tt
        set_variable = {
            name = selected_refreshment
            value = flag:food
        }
    }

    option = {
        name = wc_magic_spell_events.2001.b

        custom_tooltip = wc_magic_spell_events.2001.b.tt
        set_variable = {
            name = selected_refreshment
            value = flag:drink
        }
    }
}

wc_magic_spell_events.2101 = {
    type = activity_event
    title = wc_magic_spell_events.2101.title
    desc = wc_magic_spell_events.2101.desc
    theme = feast_activity
    override_icon = {
        reference = "gfx/interface/icons/icon_order_magic.dds"
    }

    left_portrait = {
        character = root
        animation = toast_goblet
    }

    immediate = {
        remove_character_modifier = wc_conjure_feast_modifier
        if = {
            limit = {
                has_variable = conjure_feast_duration
            }
            var:conjure_feast_duration = {
                save_scope_as = duration
            }
            remove_variable = conjure_feast_duration
        }
        else = {
            save_scope_value_as = {
                name = duration
                value = wc_spell_conjure_refreshment_duration_days_value
            }
        }
        scope:activity = {
            set_variable = {
                name = duration
                value = scope:duration
            }
        }
    }

    option = {
        name = wc_magic_spell_events.2101.a

        custom_tooltip = wc_magic_spell_events.2101.a.tt
        scope:activity = {
            set_variable = {
                name = selected_refreshment
                value = flag:food
            }
            hidden_effect = {
                every_attending_character = {
                    add_character_modifier = {
                        modifier = wc_conjure_food_modifier
                        days = wc_current_spell_duration
                    }
                }
            }
        }
    }

    option = {
        name = wc_magic_spell_events.2101.b

        custom_tooltip = wc_magic_spell_events.2101.b.tt
        scope:activity = {
            set_variable = {
                name = selected_refreshment
                value = flag:drink
            }
            hidden_effect = {
                every_attending_character = {
                    add_character_modifier = {
                        modifier = wc_conjure_drink_modifier
                        days = wc_current_spell_duration
                    }
                }
            }
        }
    }

    after = {
        trigger_event = feast.7002
    }
}